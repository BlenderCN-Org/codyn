#!/bin/sh

DEST="$(pwd)/_inst"

if [ -d "$DEST" ];
then
	rm -rf "$DEST"
fi

mkdir "$DEST"

(cd ../ && ./mingw-configure --prefix="$DEST" && make && make install) || exit 1

ZIP="$(pwd)/cpg-network-@VERSION@.zip"
DEVZIP="$(pwd)/cpg-network-dev-@VERSION@.zip"

curdir="$(pwd)"
cd "$DEST"

rm -f "$ZIP"
rm -f "$DEVZIP"

zip -r "$DEVZIP" include/* lib/*
zip -r "$ZIP" bin/* share/cpg-network-@CPG_NETWORK_API_VERSION@ share/mime/packages/cpg.xml

cd "$curdir"
rm -rf "$DEST"
